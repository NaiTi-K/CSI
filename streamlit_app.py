import streamlit as st
import pandas as pd
import pickle
from PIL import Image
with open("tree_model.pkl", "rb") as f:
    model = pickle.load(f)
st.set_page_config(
    page_title="Environmental Risk Dashboard",
    layout="centered",
    initial_sidebar_state="expanded"
)
st.markdown(
    """
    <style>
    body {
        background-color: #0e1117;
        color: #f0f0f0;
    }
    .stButton>button {
        background-color: #1f77b4;
        color: white;
    }
    </style>
    """, unsafe_allow_html=True
)

page = st.sidebar.radio("Choose a Section", [
    "üìå About",
    "üß™ Risk Prediction",
    "üìä Visualizations",
    "üß† Insights",
    "üåç Landscape Change",
    "üì§ Policy Summary"
])
if page == "üìå About":
    st.title("‚öõÔ∏è The Price of Power")
    st.markdown("""
    ### India's Nuclear Ambitions and the Cost to Marginalized Communities
    In Jharkhand‚Äôs mineral belt, the Uranium Corporation of India Ltd. (UCIL) supports India‚Äôs nuclear energy drive. 
    But its legacy has also included environmental degradation, displaced communities, and health crises.

    This project asks:
    > Can a public-sector enterprise like UCIL transform into a model of **ethical mining**, balancing national interest with **environmental protection** and **social justice**?

    **Track:** Tech-AI/ML Track  
    **Focus:** *Data-Driven Environmental Monitoring and Risk Prediction*

    üõ∞Ô∏è We use **remote sensing**, **machine learning**, and **interactive dashboards** to:
    - Detect landscape changes (forest loss, urban expansion, barren land)
    - Predict risk zones based on illnesses and deforestation
    - Support evidence-based policy planning
    """)
elif page == "üß™ Risk Prediction":
    st.title("üß™ Predict Environmental Risk Zones")
    st.markdown("""
    ### Why This?
    UCIL's operations have affected vegetation, air quality, and health in nearby communities.
    This tool helps **simulate regional vulnerability** using:
    - üå≤ Forest loss as ecological degradation
    - ü§í Reported illnesses as public health markers

    Combined with mining distance, year and zone, a decision tree predicts the **environmental risk level**.
    """)

    with st.expander("‚ÑπÔ∏è About the Inputs"):
        st.markdown("""
        - **Forest Cover Loss (ha):** Deforestation indicator
        - **Reported Illnesses:** Public health indicator
        - **Distance to Mines:** Default 5.0 km for all inputs (proxy exposure)
        - **Year & Zone:** Fixed to allow uniform simulation
        """)

    forest = st.slider("üå≤ Forest Cover Loss (ha)", 0.0, 1500.0, 100.0, 10.0)
    illness = st.slider("ü§í Reported Illnesses", 0, 1000, 100, 50)

    with st.expander("üìã Review Input Summary"):
        st.write(f"Forest Loss: {forest} ha")
        st.write(f"Reported Illnesses: {illness}")
        st.write("Distance to Mines: 5.0 km (default)")
        st.write("Year: 2023, Zone: 2 (default)")

    st.info("üí° Use this like a **policy lever** ‚Äî modify environmental conditions and simulate outcomes.")

    if st.button("üîç Predict Risk"):
        input_df = pd.DataFrame([{
            'Zone': 2,
            'Year': 2023,
            'Forest_Cover_Loss(ha)': forest,
            'Distance_to_Mines(km)': 5.0,
            'Reported_Illnesses': illness
        }])

        prediction = model.predict(input_df)[0]
        st.markdown("---")

        if prediction == 1:
            st.error("üö® **High Risk Zone Identified**")
            st.warning("‚ö†Ô∏è Deforestation and health signals indicate ecological stress. Consider mitigation.")
        else:
            st.success("‚úÖ **Low Risk Zone**")
            st.success("üåø Environmental indicators remain within safe thresholds.")
    st.markdown("---")
    st.subheader("üì• Download Proxy Dataset")
    st.markdown("Use the button below to access the proxy dataset used for model training and interpretation.")
    with open("model\environmental_risk_data.csv", "rb") as file:
        st.download_button("üìÑ Download CSV", data=file, file_name="environmental_risk_data.csv", mime="text/csv")        
elif page == "üìä Visualizations":
    st.title("üìä Risk Signal Analysis")
    st.markdown("""
    To understand *why* the model makes certain predictions, we visualize the **data distribution**, **feature relevance**, and **class imbalance**.
    """)

    with st.expander("üîó Correlation Heatmap", expanded=True):
        st.image("heatmap.png", use_container_width=True)
        st.markdown("""
        - Visualizes how features are **related** to each other.
        - üîç Helps identify redundancy or inverse signals.
        - Here, forest loss and illnesses show **independent behavior**, which boosts their importance.
        """)

    with st.expander("üåü Feature Importance", expanded=True):
        st.image("feature_imp.png", use_container_width=True)
        st.markdown("""
        - Decision tree weights shown via bar graph.
        - üå≤ `Forest_Cover_Loss(ha)` and ü§í `Reported_Illnesses` dominate predictions.
        - Zone, year, distance are nearly irrelevant.
        - ‚úÖ Suggests only 2 features explain most risk ‚Äî ideal for **rapid field prediction**.
        """)

    with st.expander("üìà Risk Zone Distribution", expanded=True):
        st.image("distribution.png", use_container_width=True)
        st.markdown("""
        - Examines how many zones are **High Risk** vs **Low Risk**.
        - Imbalance matters: too few high-risk zones ‚Üí model might miss them.
        - Consider **recall/precision tradeoff** in deployment.
        """)

    st.markdown("---")
    st.success("üìå These plots **justify** and **explain** model behavior ‚Äî crucial for policy usage.")
elif page == "üß† Insights":
    st.title("üß† Interpretable AI: How the Model Thinks")
    st.markdown("""
    > Transparency is vital when AI models influence environmental policy. This section shows **why** our model predicts what it does.
    """)

    st.subheader("üìâ Confusion Matrix")
    st.image("conf_matrix.png", use_container_width=True)
    st.markdown("""
    - True Positives = High-risk zones correctly flagged
    - False Negatives = Risky zones missed (‚ö†Ô∏è critical to minimize)
    """)

    st.subheader("üå≥ Decision Tree")
    st.image("tree.png", use_container_width=True)
    st.markdown("""
    - The tree‚Äôs top splits involve `Forest_Cover_Loss` and `Illnesses`
    - Thresholds reveal **decision rules** that are human-readable
    - üåê Enables **interpretable risk zones** ‚Äî not black-box!
    """)

elif page == "üåç Landscape Change":
    st.title("üåç Remote Sensing-Based Environmental Change (2013‚Äì2023)")
    st.markdown("---")
    st.markdown("""
    This section combines satellite-derived layers to uncover how the landscape has changed over a decade.  
    These insights help us understand the driving factors behind environmental risk in a **spatial and visual** way.
    """)
    st.header("üåø NDVI Change Detection")
    st.markdown("""
    > To assess **vegetation health and loss**, we use NDVI (Normalized Difference Vegetation Index) ‚Äî a proxy for green biomass.

    - NDVI was computed using Landsat imagery for the years **2013** and **2023**.
    - By subtracting the 2013 NDVI from 2023 NDVI, we visualize regions that have:
      - **Lost green cover** (deforestation)
      - **Gained vegetation** (reforestation or crop regrowth)
    """)

    col1, col2 = st.columns([2, 1])
    with col1:
        st.image("remote_sensing/NDVI_Change_Map.tif", caption="NDVI Change Map (2013‚Äì2023)", use_container_width=True)
    with col2:
        st.markdown("### üå± NDVI Legend")
        st.markdown("""
        <div style='font-size:14px'>
        <div><span style='color:#FF0000'>‚ñ†</span> Vegetation Loss (Red)</div>
        <div><span style='color:#0000FF'>‚ñ†</span> Vegetation Gain (Blue)</div>
        </div>
        """, unsafe_allow_html=True)

    st.markdown("""
    üîç **Interpretation:**
    - üî¥ Large red patches show widespread vegetation loss ‚Äî possibly due to mining, urban sprawl, or illegal logging.
    - üîµ Smaller blue regions show localized regrowth or cropping.
    - This layer gives direct ecological evidence of **where the land has degraded**.
    """)

    st.header("üóΩ Land Use Land Cover Classification (LULC)")
    st.markdown("""
    > To understand how land types have evolved, we classified the landscape into:
    - Forest (0), Urban (1), Barren (2), and Water (3)

    Using Random Forest and ESA WorldCover labels, we generated LULC maps for **2013** and **2023**.
    """)

    for year in ["2013", "2023"]:
        st.subheader(f"üìç LULC {year}")
        col1, col2 = st.columns([2, 1])
        with col1:
            st.image(f"remote_sensing/LULC_{year}_colored.tif", caption=f"LULC {year}", use_container_width=True)
        with col2:
            st.markdown("### üìò Legend")
            st.markdown("""
            <div style='font-size:14px'>
            <div><span style='color:#00FF00'>‚ñ†</span> Forest (0)</div>
            <div><span style='color:#FF0000'>‚ñ†</span> Urban (1)</div>
            <div><span style='color:#D2B48C'>‚ñ†</span> Barren (2)</div>
            <div><span style='color:#0000FF'>‚ñ†</span> Water (3)</div>
            </div>
            """, unsafe_allow_html=True)

    st.markdown("""
    üîç **Interpretation:**
    - Urban regions (red) expanded considerably between 2013 and 2023.
    - Forest areas (green) were visibly replaced by barren and urban patches.
    - These changes reflect **land degradation** and **habitat conversion**.
    """)
    st.header("üîÅ LULC Transition Map")
    st.markdown("""
    > To pinpoint how land types changed (not just where), we computed a **transition map** from the LULC classifications.

    For example:
    - Forest ‚Üí Urban = 01
    - Urban ‚Üí Barren = 12
    """)

    col1, col2 = st.columns([2, 1])
    with col1:
        st.image("remote_sensing\LULC_Transition_Cleaned_2013_2023.tif", caption="LULC Transitions (2013‚Äì2023)", use_container_width=True)
    with col2:
        st.markdown("### üîÑ Transition Legend")
        st.markdown("""
        <div style='font-size:14px'>
        <div><span style='color:#FF0000'>‚ñ†</span> Forest ‚Üí Urban (01)</div>
        <div><span style='color:#D2B48C'>‚ñ†</span> Forest ‚Üí Barren (02)</div>
        <div><span style='color:#0000FF'>‚ñ†</span> Forest ‚Üí Water (03)</div>
        <div><span style='color:#800000'>‚ñ†</span> Barren ‚Üí Urban (21)</div>
        <div><span style='color:#B22222'>‚ñ†</span> Water ‚Üí Urban (31)</div>
        <div><span style='color:#808080'>‚ñ†</span> Urban ‚Üí Barren (12)</div>
        <div><span style='color:#00FF00'>‚ñ†</span> Urban ‚Üí Forest (10)</div>
        <div><span style='color:#228B22'>‚ñ†</span> Water ‚Üí Forest (30)</div>
        </div>
        """, unsafe_allow_html=True)

    st.markdown("""
    üîç **Insights:**
    - The most dominant transition is `Forest ‚Üí Urban` ‚Äî a sign of urban encroachment.
    - Other worrying transitions include `Forest ‚Üí Barren`, reflecting deforestation and land degradation.
    - Very few transitions show restoration (`Urban ‚Üí Forest`) ‚Äî suggesting **limited recovery**.
    """)

    st.header("üåÉ VIIRS Nighttime Lights: Proxy for Urban Growth")
    st.markdown("""
    > VIIRS nightlight data measures emitted brightness from Earth at night ‚Äî a proxy for human settlement and urban activity.

    We compared composites from **2014** and **2023** to visualize expansion of built-up areas.
    """)

    col1, col2 = st.columns([2, 1])
    with col1:
        st.image("remote_sensing/Nightlight_Growth_2014_2023.tif", caption="Nightlight Growth (2014‚Äì2023)", use_container_width=True)
    with col2:
        st.markdown("### üí° Nightlight Legend")
        st.markdown("""
        <div style='font-size:14px'>
        <div><span style='color:red'>‚ñ†</span> Very Low Brightness</div>
        <div><span style='color:orange'>‚ñ†</span> Low Brightness</div>
        <div><span style='color:yellow'>‚ñ†</span> Moderate Brightness</div>
        <div><span style='color:lime'>‚ñ†</span> Growth Region</div>
        <div><span style='color:cyan'>‚ñ†</span> High Urban Growth</div>
        <div><span style='color:blue'>‚ñ†</span> Very Bright Urban</div>
        <div><span style='color:purple'>‚ñ†</span> City Centers / Peak Urban</div>
        <div><span style='color:black'>‚ñ†</span> No Change / Masked</div>
        </div>
        """, unsafe_allow_html=True)

    st.markdown("""
    üîç **Interpretation:**
    - Urban cores have intensified (blue, purple) and new settlements have emerged (lime, cyan).
    - Spatial patterns match LULC and NDVI transitions ‚Äî proving **built-up pressure**.
    """)

    st.markdown("## üîé Overall Interpretation")
    st.success("""
    ‚úÖ Over 10 years, this region experienced:
    - High vegetation loss and declining NDVI
    - Rapid urban expansion replacing forests and natural land
    - Increased nighttime brightness, confirming built-up growth

    üìå These multi-source insights support **evidence-based planning** for:
    - Conservation zones
    - Urban containment strategies
    - Risk mitigation from ecological degradation
    """)

    



elif page == "üì§ Policy Summary":
    st.title("üì§ Policy Blueprint Suggestions")
    st.markdown("---")
    st.markdown("""
    Based on our model and visual insights, here‚Äôs an interdisciplinary action plan:
    - üõë **Regulate zones** with >500 ha forest loss and >70 reported illnesses
    - üöë **Deploy mobile healthcare units** to predicted high-risk regions
    - üõ∞Ô∏è **Integrate satellite monitoring** with local illness data streams
    - üìä **Publish open dashboards** for mining zone risk
    - üìú **Update UCIL ESG policy** to account for public health & ecological metrics
    """)

st.markdown("---")
st.markdown("¬© 2025 ‚Ä¢ Developed for Tech-AI/ML Track ‚Ä¢ Environmental Risk Project")
